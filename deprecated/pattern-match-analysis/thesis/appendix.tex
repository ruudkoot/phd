\appendix

\chapter{Demonstration of Implementation}\label{appx}

\section{Input}
\begin{Verbatim}
main = let f = \b -> \phi -> if b
                             then if phi [42] then 100 else 200
                             else if phi [43] then 300 else 400
           g = \x -> case x of
                        []     -> True
           h = \x -> case x of
                        (a:as) -> True
        in f True g
\end{Verbatim}

\section{Output}
\begin{Verbatim}
"== [1] REFINEMENT TYPES =============================="
?148
-- [2] --------------------
[?0 = [?15]@?27 | ?
,?1 = [?46]@?82 | ?
,?4 = Bool@?193 | ?
,Int@?247 = Int@?274 | ?
,?2299 = Bool@?463 | ?
,Int@?247 = Int@?355 | ?
,?58 = (?1003 -> ?2299)@?3595 | app1
,?1003 = [?571]@?3163 | app2
,Int@?4459 = ?571 | ?
,?2326 = Bool@?490 | ?
,Int@?274 = Int@?382 | ?
,?58 = (?1030 -> ?2326)@?3622 | app1
,?1030 = [?598]@?3190 | app2
,Int@?4486 = ?598 | ?
,?418 = (?67 -> ?148)@?229 | app1
,?67 = (?1 -> Bool@?28)@?10 | app2
,(?4 -> (?58 -> Int@?247)@?85)@?31 = (?175 -> ?418)@?661 | app1
,?175 = Bool@?94 | app2
]
-- [3] --------------------
λ ⊆ ?3
?27 ⊆ {_:?39}
{True} ⊆ ?12
λ ⊆ ?10
?82 ⊆ {[]}
{True} ⊆ ?28
λ ⊆ ?31
λ ⊆ ?85
?193 ⊆ {False,True}
?463 ⊆ {False,True}
λ ⊆ ?3595
{_:[]} ⊆ ?3163
{+} ⊆ ?4459
{+} ⊆ ?247
{+} ⊆ ?355
?490 ⊆ {False,True}
λ ⊆ ?3622
{_:[]} ⊆ ?3190
{+} ⊆ ?4486
{+} ⊆ ?274
{+} ⊆ ?382
λ ⊆ ?229
λ ⊆ ?661
{True} ⊆ ?94
-- [4] --------------------
?0 ↦ [?15]@?27
?1 ↦ [Int@?4459]@?82
?1003 ↦ [Int@?4459]@?82
?1030 ↦ [Int@?4459]@?82
?148 ↦ Int@?382
?175 ↦ Bool@?94
?2299 ↦ Bool@?28
?2326 ↦ Bool@?28
?4 ↦ Bool@?94
?418 ↦ (([Int@?4459]@?82 -> Bool@?28)@?10 -> Int@?382)@?229
?46 ↦ Int@?4459
?571 ↦ Int@?4459
?58 ↦ ([Int@?4459]@?82 -> Bool@?28)@?10
?598 ↦ Int@?4459
?67 ↦ ([Int@?4459]@?82 -> Bool@?28)@?10
. .[5]. . . . . . . . . . .
?193 ↦ ?94
?247 ↦ ?382
?274 ↦ ?382
?31 ↦ ?661
?3163 ↦ ?82
?3190 ↦ ?82
?355 ↦ ?382
?3595 ↦ ?10
?3622 ↦ ?10
?4486 ↦ ?4459
?463 ↦ ?28
?490 ↦ ?28
?85 ↦ ?229
---------------------------
Sanity check: PASSED
-= [6] =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
Int@?382
-- [7] --------------------
λ ⊆ ?3
?27 ⊆ {_:?39}
{True} ⊆ ?12
λ ⊆ ?10
?82 ⊆ {[]}
{True} ⊆ ?28
λ ⊆ ?661
λ ⊆ ?229
?94 ⊆ {False,True}
?28 ⊆ {False,True}
λ ⊆ ?10
{_:[]} ⊆ ?82
{+} ⊆ ?4459
{+} ⊆ ?382
{+} ⊆ ?382
?28 ⊆ {False,True}
λ ⊆ ?10
{_:[]} ⊆ ?82
{+} ⊆ ?4459
{+} ⊆ ?382
{+} ⊆ ?382
λ ⊆ ?229
λ ⊆ ?661
{True} ⊆ ?94
-= [8] =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
Lower: {[?27 ~> {?27 ⊆ {_:?39}}]}
Upper: {[?39 ~> {?27 ⊆ {_:?39}}]}
. .[9]. . . . . . . . . . .
"?10 ~> {}"
"?12 ~> {}"
"?229 ~> {}"
"?27 ~> {\"?39\"}"
"?28 ~> {}"
"?3 ~> {}"
"?382 ~> {}"
"?39 ~> {\"?27\"}"
"?4459 ~> {}"
"?661 ~> {}"
"?82 ~> {}"
"?94 ~> {}"
-- [10] -------------------
Input vars          : fromList []
Input-dependent vars: fromList []
-- [11] -------------------
. .[12] . . . . . . . . . .
λ ⊆ ?3
?27 ⊆ {_:?39}
{True} ⊆ ?12
λ ⊆ ?10
?82 ⊆ {[]}
{True} ⊆ ?28
λ ⊆ ?661
λ ⊆ ?229
?94 ⊆ {False,True}
?28 ⊆ {False,True}
λ ⊆ ?10
{_:[]} ⊆ ?82
{+} ⊆ ?4459
{+} ⊆ ?382
{+} ⊆ ?382
?28 ⊆ {False,True}
λ ⊆ ?10
{_:[]} ⊆ ?82
{+} ⊆ ?4459
{+} ⊆ ?382
{+} ⊆ ?382
λ ⊆ ?229
λ ⊆ ?661
{True} ⊆ ?94
-- [13] -------------------
?10 ↦ (λ,λ)
?12 ↦ ({True},{False,True})
?229 ↦ (λ,λ)
?27 ↦ ({},{_:[],_:_:[],_:_:_:[],_:_:_:_:[],_:_:_:_:_:*})
?28 ↦ ({True},{False,True})
?3 ↦ (λ,λ)
?382 ↦ ({+},{-,0,+})
?39 ↦ ({},T_List)
?4459 ↦ ({+},{-,0,+})
?661 ↦ (λ,λ)
?82 ↦ ({_:[]},{[]})
?94 ↦ ({True},{False,True})
---------------------------
Sanity check: FAILED
Sanity check: FAILED
-- [14] -------------------
>> PATTERN-MATCH FAILURE DETECTED!!! <<
---[15] -------------------
forall. [] => Int@{+}
\end{Verbatim}

\section{Legend}
The individual sections of the output generated by our implementation of the analysis are:
\begin{enumerate}
\item The inferred type $\tauhat$ (without any substitutions having been applied to it.)
\item The inferred equality constraint set $C$ (without any substitutions having been applied to it.)
\item The inferred subset constraint set $R$ (without any substitutions having been applied to it.)
\item The substitution $\theta_\mathrm{C}$ of type variables found by unifying $C$.
\item The substitution $\theta_\mathrm{C}$ of annotation variables found by unifying $C$.
\item The inferred type $\tauhat$ with the substitution $\theta_\mathrm{C}$ applied to it.
\item The inferred subset constraint set $R$ with the substitution $\theta_\mathrm{C}$ applied to it.
\item Dependency analysis of the constraints.
\item Dependency analysis of the annotation variables.
\item List of input and input-dependent variables.
\item Input-dependent constraints ($R'$).
\item Input-independent constraints ($R - R'$).
\item Solution of $R - R'$ found by constraint solver.
\item Result of the analysis (``pattern match failure detected'' or ``no pattern match failure can occur at run-time.'')
\item Inferred type after generalization.
\end{enumerate}
The intermediate steps of the analysis are shown for the top-level binding only.
